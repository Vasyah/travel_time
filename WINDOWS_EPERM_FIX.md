# Решение проблемы EPERM на Windows

## Проблема

При разработке на Windows с Next.js возникает ошибка:

```
EPERM: operation not permitted, rename
```

## Быстрое решение

### Вариант 1: Использовать npm скрипт

```bash
npm run dev:clean
```

Этот скрипт автоматически:

- Остановит все процессы Node.js
- Удалит папку `.next`
- Запустит dev сервер

### Вариант 2: Ручная очистка

```powershell
# Остановить все процессы Node
Get-Process node -ErrorAction SilentlyContinue | Stop-Process -Force

# Удалить кеш
Remove-Item -Recurse -Force .next

# Запустить dev сервер
npm run dev
```

## Долгосрочное решение

### 1. Добавить исключения в Windows Defender

1. Откройте **Windows Security** (Безопасность Windows)
2. Перейдите в **Защита от вирусов и угроз**
3. Нажмите **Управление настройками**
4. Прокрутите до **Исключения** и нажмите **Добавить или удалить исключения**
5. Добавьте следующие папки:
    - `C:\repository\projects\travel_time\.next`
    - `C:\repository\projects\travel_time\node_modules`
    - Весь путь к проекту: `C:\repository\projects\travel_time`

### 2. Отключить индексацию Windows для папки проекта

1. Откройте свойства папки проекта
2. Снимите галочку **Разрешить индексирование содержимого файлов**
3. Примените изменения

### 3. Использовать WSL2 (рекомендуется)

Для лучшей производительности и отсутствия проблем с EPERM:

```bash
# Установить WSL2
wsl --install

# Перенести проект в WSL
# и работать оттуда
```

## Причина проблемы

Windows Defender и другие антивирусы сканируют файлы при изменении, блокируя их на короткое время. Next.js пытается переименовать временные файлы, но не может этого сделать из-за блокировки.

## Что было сделано в проекте

1. ✅ Добавлен скрипт `npm run clean` для автоматической очистки
2. ✅ Добавлен скрипт `npm run dev:clean` для очистки и запуска
3. ✅ Добавлена оптимизация `onDemandEntries` в `next.config.ts`
4. ✅ Создан индексный файл для PhoneInput компонента

## Полезные команды

```bash
# Очистка и запуск
npm run dev:clean

# Только очистка
npm run clean

# Обычный запуск
npm run dev

# Проверить запущенные процессы Node
Get-Process node

# Убить конкретный процесс по ID
Stop-Process -Id PROCESS_ID -Force
```
